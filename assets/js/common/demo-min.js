/*! doc 2014-03-19 */
define("common/demo",["bui/common","bui/toolbar","bui/overlay"],function(t){function e(){return o.dialog||(o.dialog=new a({title:"Demo",elCls:"demo-dialog",width:800,height:500})),o.dialog}var n=t("bui/common"),r=t("bui/toolbar"),i=t("bui/overlay"),a=i.Dialog,o=n.Component.Controller.extend({renderUI:function(){var t=this,e=t.get("tpl"),n=t.get("el"),i=t.get("tbar");$(e).appendTo(n),i.render=t.get("el").find(".panel-header"),i=new r.Bar(i),i.render(),t.set("tbar",i)},bindUI:function(){var t=this,e=t.get("tbar");e.on("click",function(e){var n=e.target,r=n.get("type");"run"==r?t.run():"source"==r&&t.showSource()})},fetchSource:function(){var t=this,e=t.get("redirectUrl"),n=t.get("url");$.ajax({dataType:"jsonp",url:e,data:{file:n},success:function(e){t.set("source",e)},error:function(){}})},run:function(){var t=this,e=t.get("dialog"),r=t.get("runTpl"),i=t.get("url");r=n.substitute(r,{src:i}),e.set("bodyContent",r),e.show()},showScriptCode:function(){var t=this,e=t.get("el"),n=t.getScriptCode(),r=e.find(".panel-body");n=n.replace(/\\/gi,"<br/>"),r.html(n),window.prettyPrintEl&&prettyPrintEl(r[0])},getScriptCode:function(t){var e,n=this,r=n.get("beginTag"),i=n.get("endTag");return t=t||n.get("source"),e=t.indexOf(r),t=t.substring(e+r.length),e=t.lastIndexOf(i),-1!==e&&(t=t.substring(0,e)),t},showSource:function(){var t=this,e=t.get("source"),n=t.get("dialog"),r=t.get("sourceTpl"),i=$(r);n.set("bodyContent",i),i.html(e),n.show()},_uiSetSource:function(t){var e=this;e.showScriptCode(t)}},{_dialog:null,ATTRS:{redirectUrl:{value:"http://www.builive.com/fetchdemo.php"},dialog:{getter:function(){return e()}},beginTag:{value:"&lt;!-- script start--&gt;  \n"},endTag:{value:"&lt;!-- script end --&gt;"},sourceTpl:{value:"<textarea></textarea>"},runTpl:{value:'<iframe width="100%" height="100%" src="{src}" frameborder="0"></iframe>'},source:{},url:{},tbar:{valueFn:function(){return{elCls:"button-group pull-right",defaultChildCfg:{elCls:"button button-small"},children:[{content:"运行",type:"run"},{content:"源码",type:"source"}]}}},tpl:{value:'<div class="panel"><div class="panel-header">代码示例</div><pre class="panel-body"></pre></div>'}}},{xclass:"demo"});return o});